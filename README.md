# apollo_core
MQTT backend

Описание системы Apollo

1 Составные части системы
1.1 Сервер - логический центр системы, выполняет функции управления и конфигурирования остальных частей. Выполнен на NXP i.MX6 SOLO (800 MHz, 4 GB eMMC Flash, 512 MB DDR3L, 64kB EEPROM), операционная система Linux. Cовмещен с сенсорной панелью оператора — дисплей 7 дюймов, разрешение 1024х600 пикс. Имеет интерфейс ETHERNET и CAN для подключений остальных компонентов. Загрузка конфигурации через ETHERNET или USB флеш. Резервирование?

1.2 Netline 2/4/8 - преобразует сигналы управления от сервера в физические порты DMX512 для подключения силовых диммеров и свитчей. Подключение через ETHERNET.

1.3 DimRack 48/96 - преобразует сигналы управления от сервера в силу.

1.4 Сплиттер CAN - служит для питания кнопочных панелеи, распределения и гальванической изоляции  шины CAN.

1.5 Кнопочные панели 1 - преобразуют команды пользователя в интерфейс CAN. Имеют 4 кнопки с двухцветной подсветкой. Максимальное количество 255 штук. Адрес задается DIP переключателем. 

1.6 Кнопочные панели 2 - преобразуют команды пользователя в интерфейс CAN. Основаны на базе блока MC-12. Максимальное количество 255 штук. Адрес задается DIP переключателем.

1.7 Шлюз ETHERNET-CAN - преобразует команды интерфейса CAN передаваемые по ETHERNET от сервера в физический CAN для подключения кнопочных панелей. (опционально: пояснения далее) 

1.8 Конфигуратор - программа на компьютере под ОС Windows, служит для создания конфигурации системы и загрузки ее в сервер или формирования файла для загрузки через USB. 


2 Общее описание
2.1 Сервер, внутренне устройство. Серверная часть состоит из ядра системы, брокера MQTT протокола, шлюза MQTT - CAN и пользовательского интерфейса на QT QML.

2.2 Подключение исполнительных устройств возможны 2 варианта:
2.2.1 Сервер преобразует управление в стандартный протокол sACN с указанным в конфигураторе номером юниверса и отправляет на DimRack/Netline или другое оборудование с его поддержкой.  Конфигурирование каналов DimRack/Netline вручную в соответствии с данными в конфигураторе системы.
2.2.2 Полная интеграция  DimRack/Netline в систему управления, при этом они будут конфигурироваться автоматически от сервера.  DimRack получит полную настройку каналов (возможно при этом изменение параметра канала на стойке будет заблокировано), в случае с  Netline порт DMX будет переведен в режим данных системы (скорее всего будет недоступен для данных ArtNet/sACN или надо думать над объединением данных)

2.3 Подключение управляющих устройств 2 варианта:
2.3.1 Подключение кнопочных панелей напрямую к серверу к порту CAN. При таком варианте усложняется резервирование сервера, т.к. надо тянуть к резервному серверу два кабеля ETHERNET и CAN.
2.3.2 Подключение кнопочных панелей через шлюз ETHERNET-CAN дает большую гибкость в размещении оборудования и прокладки кабелей, проще монтаж на готовых объектах, проще резервирование — нужен только  ETHERNET. Шлюз можно использовать готовый или сделать свой. Пример готового https://www.peak-system.com/PCAN-Ethernet-Gateway-FD-DR.538.0.html?&L=1.
Вариант подключения кнопочных панелей (шлюз или напрямую) можно сделать опцией с выбором варианта через конфигуратор системы.


![Scheme](/home/xamuh/code/apollo_core/scheme.jpg "Scheme")
